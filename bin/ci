#!/usr/bin/env bash

set -e

npm run build

if [ "$CONTINUOUS_INTEGRATION" == "true" ] && [ "$TRAVIS_PULL_REQUEST" == "false" ]; then
    git config user.email "info@pravdomil.com"
    git config user.name "pravdomil"
    
    echo "Publishing to GitHub Pages"
    npx gh-pages -d public -r "https://$GITHUB_TOKEN@github.com/$TRAVIS_REPO_SLUG.git"
    
    echo "Updating readme"
    git reset
    git checkout master
    git add readme.md
    if [ "$(git diff --cached --stat)" != "" ]; then
        git commit -m "update readme"
        git push "https://$GITHUB_TOKEN@github.com/$TRAVIS_REPO_SLUG.git"
    fi
fi
